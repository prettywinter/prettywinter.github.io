# # This is a basic workflow to help you get started with Actions

# name: CI

# # Controls when the workflow will run
# on:
#   # Triggers the workflow on push or pull request events but only for the main branch
#   push:
#     branches: [ main ]

# # A workflow run is made up of one or more jobs that can run sequentially or in parallel
# jobs:
#   # This workflow contains a single job called "build"
#   build:
#     # The type of runner that the job will run on
#     runs-on: ubuntu-latest
#     name: A job to deploy blog.
#     # Steps represent a sequence of tasks that will be executed as part of the job
#     steps: 
#       - name: Install Dependencies
#         run: npm i

#       - name: Hexo Action
#       # You may pin to the exact commit or the version.
#       # uses: sma11black/hexo-action@08f5143fa402cdaccf9fc016d6bc91329f082eb0
#         uses: sma11black/hexo-action@v1.0.4
#         with:
#           # Github user name
#           user_name: prettywinter # default is github-actions[bot]
#           # Github email
#           user_email: jhlzlove@163.com # default is 41898282+github-actions[bot]@users.noreply.github.com
#           # The deploy key for Github Pages repo
#           deploy_key: ${{ secrets.DEPLOY_SECRET}} # default is 
#           # Git commit messages to your GitHub Pages repository.
#           commit_msg: Automatic deploy by Github Action # optional, default is 

name: Hexo Deploy

on:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: ubuntu-latest
    if: github.event.repository.owner.id == github.event.sender.id

    steps:
      - name: Checkout source
        uses: actions/checkout@v2
        with:
          ref: master

      - name: Setup Node.js
        uses: actions/setup-node@v1
        with:
          node-version: '16.x'

      - name: Setup Hexo
        env:
          ACTION_DEPLOY_KEY: ${{ secrets.DEPLOY_SECRET }}
        run: |
          mkdir -p ~/.ssh/
          echo "$ACTION_DEPLOY_KEY" > ~/.ssh/id_rsa
          chmod 700 ~/.ssh
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan github.com >> ~/.ssh/known_hosts
          git config --global user.email "jhlzlove@163.com"
          git config --global user.name "jhlz"
          npm install hexo-cli -g
          npm install

      - name: Deploy
        run: |
          hexo clean
          hexo deploy